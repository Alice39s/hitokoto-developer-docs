# 接口定义

## 用户部分

### 身份认证

::: theorem 登录接口

* 路径： `/auth/login`
* 方法： `POST`
* 身份认证：否
* 无返回：否
* **此接口存在未来变动的可能，建议定期观察可用性。**

:::

以下为该接口可用的请求参数：

| 参数       | 类型     | 规则        | 示例               | 备注   |
|----------|--------|-----------|------------------|------|
| email    | string | 必须是 Email | user@hitokoto.cn | 用户邮箱 |
| password | string | 非空        | gugugu           | 密码   |

可能存在的错误：
| 错误代码 | 原因      |
|------|---------|
| -1   | 账户或密码错误 |
| 400  | 请求参数错误  |

--------------------

::: theorem 注册接口

* 路径： `/auth/register`
* 方法： `POST`
* 身份认证：否
* 无返回：否
* **此接口存在未来变动的可能，建议定期观察可用性。**
:::

以下为该接口可用的请求参数：
| 参数       | 类型     | 规则     | 示例               | 备注  |
|----------|--------|--------|------------------|-----|
| name     | string | 非空     | 皮皮喵              | 用户名 |
| password | string | 非空     | gugugu           | 密码  |
| email    | string | 非空; 邮箱 | pipi@hitokoto.cn | 邮箱  |

可能存在的错误：
| 错误代码 | 原因           |
|------|--------------|
| -1   | 邮箱已被占用       |
| -2   | 创建失败，可能是参数问题 |
| 400  | 触发校验器错误      |

--------------------

::: theorem 重置密码

* 路径： `/auth/password/reset`
* 方法： `POST`
* 身份认证：否
* 无返回：否
* **此接口存在未来变动的可能，建议定期观察可用性。**
:::

以下为该接口可用的请求参数：
| 参数       | 类型     | 规则     | 示例               | 备注  |
|----------|--------|--------|------------------|-----|
| email    | string | 非空; 邮箱 | pipi@hitokoto.cn | 邮箱  |

可能存在的错误：
| 错误代码 | 原因           |
|------|--------------|
| -1   | 发信错误，可能是服务器原因。       |
| 400  | 触发校验器错误      |

### 用户信息

::: theorem 取得令牌

* 路径： `/user/token`
* 方法： `GET`
* 身份认证：是
* 无返回：否
:::

> **此接口无请求参数，无返回错误**

--------------------

::: theorem 重置令牌

* 路径： `/user/token/refresh`
* 方法： `PUT`
* 身份认证：是
* 无返回：否
:::

> **此接口无请求参数，无返回错误**

--------------------

::: theorem 认证邮箱

* 路径： `/user/email/verify`
* 方法： `PUT`
* 身份认证：是
* 无返回：是
:::

> **此接口无请求参数**

可能存在的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 邮箱已认证       |
| -2   | 发信失败，服务器错误。 |

--------------------

::: theorem 修改密码

* 路径： `/user/password`
* 方法： `PUT`
* 身份认证：是
* 无返回：是
:::

以下为该接口可用的请求参数：
| 参数           | 类型     | 规则         | 示例          | 备注  |
|--------------|--------|------------|-------------|-----|
| password     | string | 非空         | gugugugu    | 密码  |
| new_password | string | 非空;长度至少为 8 | gugugugu!!! | 新密码 |

可能出现的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 密码错误        |
| -2   | 无法修改，服务器问题。 |
| 400  | 触发校验器错误     |

--------------------

::: theorem 修改邮箱

* 路径： `/user/email`
* 方法： `PUT`
* 身份认证：是
* 无返回：是
* **此接口存在未来变动的可能，建议定期观察可用性。**
:::

以下为该接口可用的请求参数：
| 参数           | 类型     | 规则         | 示例          | 备注  |
|--------------|--------|------------|-------------|-----|
| email     | string | 非空；邮箱         | i@freejishu.com    | 新邮箱  |

可能出现的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 邮箱被占用        |
| 400  | 触发校验器错误     |

--------------------

::: theorem 获取通知配置

* 路径： `/user/notification/settings`
* 方法： `GET`
* 身份认证：是
* 无返回：否
:::

> **此接口无请求参数，无返回错误**

--------------------

::: theorem 更新通知配置

* 路径： `/user/notification/settings`
* 方法： `PUT`
* 身份认证：是
* 无返回：否
:::

以下为请求参数：
| 参数                      | 类型      | 规则     | 示例   | 备注                     |
|-------------------------|---------|--------|------|------------------------|
| email_global            | boolean | 布尔; 可选 | TRUE | 全局邮箱通知设定（当为真时，覆盖子通知配置） |
| email_hitokoto_appended | boolean | 布尔; 可选 | TRUE | 成功添加一言时通知              |
| email_hitokoto_reviewed | boolean | 布尔; 可选 | TRUE | 一言审核结果通知               |
| email_poll_created      | boolean | 布尔; 可选 | TRUE | 投票创建时通知                |
| email_poll_result       | boolean | 布尔; 可选 | TRUE | 投票结果公布时通知              |
| email_poll_report_daily | boolean | 布尔; 可选 | TRUE | 每日投票数据报告               |

可能的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 无法修改，服务器错误。       |
| 400  | 触发校验器错误     |

--------------------

::: theorem 获取句子数据概览

* 路径： `/user/hitokoto/summary`
* 方法： `GET`
* 身份认证：是
* 无返回：否
:::

> **此接口无请求参数，无返回错误**

--------------------

::: theorem 获取提交记录

* 路径： `/user/hitokoto/history`
* 方法： `GET`
* 身份认证：是
* 无返回：否
:::

以下为请求参数：
| 参数     | 类型      | 规则        | 示例 | 备注     |
|--------|---------|-----------|----|--------|
| offset | integer | >=0       | 0  | 偏移     |
| limit  | integer | [20, 200] | 20 | 句子规模限制 |

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| 400  | 触发校验器错误     |

### 喜爱接口

--------------------

::: theorem 获得句子喜爱数据

* 路径： `/lime`
* 方法： `GET`
* 身份认证：是
* 无返回：否
* **此接口未来可能变动，建议定期观察。**
:::

以下为请求参数：
| 参数     | 类型      | 规则        | 示例 | 备注     |
|--------|---------|-----------|----|--------|
| id | integer | >=0       | 0  | 句子 ID     |
| real_ip  | boolean | 可选 | True | 真实 IP |

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| 400  | 触发校验器错误     |

--------------------

::: theorem 喜爱句子

* 路径： `/lime`
* 方法： `GET`
* 身份认证：是
* 无返回：否
* **此接口未来可能变动，建议定期观察。**
:::

以下为请求参数：
| 参数     | 类型      | 规则        | 示例 | 备注     |
|--------|---------|-----------|----|--------|
| id | integer | >=0       | 0  | 句子 ID     |

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| 400  | 触发校验器错误     |

### 句子相关

--------------------

::: theorem 提交一言

* 路径： `/hitokoto/append`
* 方法： `POST`
* 身份认证：是
* 无返回：否
:::

以下为请求参数：
| 参数       | 类型     | 规则          | 示例          | 备注 |
|----------|--------|-------------|-------------|----|
| from     | string | 非空          | 火影忍者        | 来源 |
| from_who | string | 可选          | 漩涡鸣人        | 作者 |
| hitokoto | string | 非空          | 你没有受伤吧，胆小鬼。 | 句子 |
| type     | string | 非空；符合使用说明定义 | a           | 分类 |

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 无法提交，服务器问题。       |
| 400  | 触发校验器错误     |

--------------------

::: theorem 提交评分

* 路径： `/hitokoto/score`
* 方法： `POST`
* 身份认证：是
* 无返回：否
:::

以下为请求参数：
| 参数       | 类型     | 规则          | 示例          | 备注 |
|----------|--------|-------------|-------------|----|
| score     | integer | [0, 5]          | 5        | 分数 |
| comment     | string | 可选         | 这个句子真棒！        | 评价 |
| sentence_uuid | string | uuid          | fa344ed4-7de0-408b-a36c-f2a2a8567dfe        | 句子 UUID |

::: danger
如果低于 3 分，而无评价的话，视为无效评分!
:::

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   |   用户已打分     |
| -2   | 句子不存在或未上线       |
| 500   | 无法提交，服务器问题。       |
| 400  | 触发校验器错误     |

--------------------

::: theorem 查看句子评分

* 路径： `/hitokoto/score`
* 方法： `GET`
* 身份认证：是
* 无返回：否
:::

以下为请求参数：
| 参数       | 类型     | 规则          | 示例          | 备注 |
|----------|--------|-------------|-------------|----|
| sentence_uuid | string | uuid          | fa344ed4-7de0-408b-a36c-f2a2a8567dfe        | 句子 UUID |

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 句子不存在或未上线       |
| 400  | 触发校验器错误     |

--------------------

::: theorem 查看句子评分

* 路径： `/hitokoto/report`
* 方法： `GET`
* 身份认证：是
* 无返回：否
:::

以下为请求参数：
| 参数       | 类型     | 规则          | 示例          | 备注 |
|----------|--------|-------------|-------------|----|
| sentence_uuid | string | uuid          | 7f9908c1-02dd-4c99-80da-fb4d328065a6        | 句子 UUID |
| comment | string | 非空          |    个人感觉没啥意义。     | 句子 UUID |

::: danger
请勿尝试无意义举报，多次无意义举报将封禁账户。
:::

可能触发的错误：
| 错误代码 | 原因          |
|------|-------------|
| -1   | 句子不存在或未上线       |
| 400  | 触发校验器错误     |
